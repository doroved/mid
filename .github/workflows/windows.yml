name: MID windows

on:
  # push:
  #   branches: [ "main" ]
  # pull_request:
  #   branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - uses: actions/checkout@v3
      - name: Build
        run: cargo build --verbose
      - name: Run tests
        run: cargo test -- --nocapture
      - name: Get system metrics
        run: |
          $csproduct = Get-WmiObject Win32_ComputerSystemProduct | Select-Object -ExpandProperty UUID
          $bios = Get-WmiObject Win32_BIOS | Select-Object -ExpandProperty SerialNumber
          $baseboard = Get-WmiObject Win32_BaseBoard | Select-Object -ExpandProperty SerialNumber
          $cpu = Get-WmiObject Win32_Processor | Select-Object -ExpandProperty ProcessorId
          "$csproduct|$bios|$baseboard|$cpu"
        shell: powershell
